<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      table, th, td { border: 1px solid #ccc; border-collapse: collapse; padding: 5px; }
      th { background-color: #f0f0f0; }
      input[type="text"], input[type="date"], input[type="number"] { width: 100%; box-sizing: border-box; }
      button { margin-top: 10px; padding: 5px 10px; }
    </style>
  </head>
  <body>
    <h2>í•™êµ ê¸‰ì‹ ì¬ë£Œ ì£¼ë¬¸ì„œ</h2>

    <label>ì´ë©”ì¼: <input type="email" id="email"></label><br>
    <label>ê±°ë˜ì²˜ëª…: <input type="text" id="company"></label><br>
    <label>ë°œì‹ ìëª…: <input type="text" id="name"></label><br>
    <label>ì—°ë½ì²˜: <input type="text" id="phone"></label><br><br>

    <table id="orderTable">
      <thead>
        <tr>
          <th>No</th><th>ê¸‰ì‹ì¼</th><th>ìƒí’ˆëª…</th><th>ì„¤ëª…</th><th>ê·œê²©</th>
          <th>ìˆ˜ëŸ‰</th><th>ë‹¨ìœ„</th><th>ë‚©í’ˆì²˜</th><th>ì…ê³ í¬ë§ì¼</th><th>ë¹„ê³ </th><th>ì‚­ì œ</th>
        </tr>
      </thead>
      <tbody id="orderBody">
      </tbody>
    </table>

    <button onclick="addRow()">+ í’ˆëª© ì¶”ê°€</button>
    <button onclick="submitOrder()">ì œì¶œ</button>

    <script>
      let rowCount = 0;

      function addRow() {
        rowCount++;
        const tbody = document.getElementById("orderBody");
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${rowCount}</td>
          <td><input type="date" name="mealDate"></td>
          <td><input type="text" name="productName"></td>
          <td><input type="text" name="description"></td>
          <td><input type="text" name="specification"></td>
          <td><input type="number" name="quantity"></td>
          <td><input type="text" name="unit"></td>
          <td><input type="text" name="deliveryTo"></td>
          <td><input type="date" name="desiredDate"></td>
          <td><input type="text" name="note"></td>
          <td><button onclick="this.parentElement.parentElement.remove()">X</button></td>
        `;
        tbody.appendChild(row);
      }

      function submitOrder() {
        const email = document.getElementById("email").value.trim();
        const company = document.getElementById("company").value.trim();
        const name = document.getElementById("name").value.trim();
        const phone = document.getElementById("phone").value.trim();

        if (!email || !company || !name || !phone) {
          alert("ğŸ“Œ ë°œì‹ ì ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        const rows = document.querySelectorAll("#orderBody tr");
        let items = [];
        let hasError = false;

        rows.forEach((row, index) => {
          const cells = row.querySelectorAll("input");
          const item = {
            mealDate: cells[0].value,
            productName: cells[1].value,
            description: cells[2].value,
            specification: cells[3].value,
            quantity: cells[4].value,
            unit: cells[5].value,
            deliveryTo: cells[6].value,
            desiredDate: cells[7].value,
            note: cells[8].value
          };

          if (!item.mealDate || !item.productName || !item.quantity || !item.deliveryTo) {
            alert(`ğŸš¨ ${index + 1}ë²ˆì§¸ í’ˆëª©ì— í•„ìˆ˜ í•­ëª©ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.`);
            hasError = true;
            return;
          }

          items.push(item);
        });

        if (hasError) return;

        const scriptUrl = "https://script.google.com/macros/s/AKfycbwY-MGQjuathjK_N5ZKHk5Kc37HMGmLDNX12L65C_9tBop89tA3okfHt6nHoe0vDJyVEw/exec";  // TODO: Replace this

fetch(scriptUrl, {
  method: "POST", 
  headers: {
    "Content-Type": "application/x-www-form-urlencoded"  // ì´ ë¶€ë¶„ì„ ì¶”ê°€
  },
  body: new URLSearchParams({
    email,
    company,
    name,
    phone,
    items: JSON.stringify(items)  // JSON ë°°ì—´ì„ URLSearchParamsë¡œ ë³€í™˜í•˜ì—¬ ì „ì†¡
  })
})
.then(res => res.text())
.then(msg => {
  alert(msg);  // ì„±ê³µ ë©”ì‹œì§€ ì¶œë ¥
  window.scrollTo(0, 0);  // í™”ë©´ ìœ„ë¡œ ì´ë™
  location.reload(); // í¼ ì´ˆê¸°í™”
})
.catch(err => {
  alert("âŒ ì˜¤ë¥˜ ë°œìƒ: " + err);
  console.error(err);
}); }

      window.onload = addRow;
    </script>
  </body>
</html>
