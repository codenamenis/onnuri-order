<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
    <title>í•™êµ ê¸‰ì‹ ì¬ë£Œ ì£¼ë¬¸ì„œ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
      body {
        font-family: 'Noto Sans KR', sans-serif;
        background-color: #f8f9fa;
        margin: 0;
      }
      h2 {
        font-weight: 600;
        text-align: center;
        font-size: 3.5rem; /* íƒ€ì´í‹€ í°íŠ¸ í¬ê¸° (ì˜ˆ: 3remìœ¼ë¡œ í‚¤ìš°ê±°ë‚˜ 2remìœ¼ë¡œ ì¤„ì„) */
        margin-top: 3rem; /* íƒ€ì´í‹€ ìƒë‹¨ ë§ˆì§„ (ì˜ˆ: 3remìœ¼ë¡œ ëŠ˜ë¦¬ê±°ë‚˜ 1remìœ¼ë¡œ ì¤„ì„) */
        margin-bottom: 2rem; /* íƒ€ì´í‹€ í•˜ë‹¨ ë§ˆì§„ (ì˜ˆ: 3remìœ¼ë¡œ ëŠ˜ë¦¬ê±°ë‚˜ 1remìœ¼ë¡œ ì¤„ì„) */
        padding-top: 1rem; /* íƒ€ì´í‹€ ìƒë‹¨ íŒ¨ë”© (ì˜ˆ: 2remìœ¼ë¡œ ëŠ˜ë¦¬ê±°ë‚˜ 0.5remìœ¼ë¡œ ì¤„ì„) */
        padding-bottom: 1rem; /* íƒ€ì´í‹€ í•˜ë‹¨ íŒ¨ë”© (ì˜ˆ: 2remìœ¼ë¡œ ëŠ˜ë¦¬ê±°ë‚˜ 0.5remìœ¼ë¡œ ì¤„ì„) */
      }
      .container {
        width: 90%;
        max-width: 1600px;
        padding: 0 15px;
        margin: 0 auto;
      }
      .card {
        border: none;
        box-shadow: none;
      }
      .table {
        width: 100%;
      }
      .table thead th {
        background-color: #f0f0f0;
        text-align: center;
      }
      .table td {
        text-align: center;
        position: relative;
        vertical-align: middle;
      }
      .table td input, .table td textarea {
        width: 100%;
        box-sizing: border-box;
      }
      .required::after {
        content: '*';
        color: red;
        margin-left: 2px;
        vertical-align: super;
        font-size: 0.8em;
      }
      .info-label {
        margin-bottom: 0.5rem;
        font-weight: 500;
      }
      .info-input {
        margin-bottom: 1rem;
        width: 300px;
      }
      .button-group {
        text-align: center;
        margin-top: 1rem;
      }
      /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
      .button-group .btn {
        font-size: 1.2rem;
        padding: 10px 30px;
        border-radius: 8px;
        margin: 0 10px;
      }
      /* ë‹¬ë ¥ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
      .calendar-cell input[type="text"] {
        padding: 0.375rem 0.75rem;
        background-color: #fff;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        color: #495057;
        height: 50px;
        line-height: 1.5;
        cursor: pointer;
        text-align: center;
      }
      .calendar-cell input[type="text"]::placeholder {
        color: #6c757d;
      }
      /* ê° ì—´ì˜ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
      .meal-date-cell input[type="text"] {
        font-size: 14px;
      }
      .product-name-cell textarea {
        font-size: 16px;
        min-height: 50px;
        resize: none;
        white-space: normal;
        overflow-wrap: break-word;
        text-align: center;
        padding: 0.375rem 0.75rem;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        width: 100%;
        box-sizing: border-box;
      }
      .description-cell textarea {
        font-size: 15px;
        min-height: 50px;
        resize: none;
        white-space: normal;
        overflow-wrap: break-word;
        text-align: left;
        padding: 0.375rem 0.75rem;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        width: 100%;
        box-sizing: border-box;
      }
      .specification-cell input[type="text"] {
        font-size: 14px;
        height: 50px;
        text-align: center;
      }
      .quantity-cell input[type="number"] {
        font-size: 16px;
        height: 50px;
        text-align: center;
      }
      .unit-cell input[type="text"] {
        font-size: 14px;
        height: 50px;
        text-align: center;
      }
      .delivery-to-cell input[type="text"] {
        font-size: 16px;
        height: 50px;
        text-align: center;
      }
      .desired-date-cell input[type="text"] {
        font-size: 14px;
        height: 50px;
        text-align: center;
      }
      .note-cell input[type="text"] {
        font-size: 15px;
        height: 50px;
        white-space: normal;
        overflow-wrap: break-word;
        text-align: center;
      }
      /* íˆ´íŒ ìŠ¤íƒ€ì¼ */
      .table td input[title]:hover::after,
      .table td textarea[title]:hover::after {
        content: attr(title);
        position: absolute;
        background-color: #333;
        color: #fff;
        padding: 5px 10px;
        border-radius: 4px;
        z-index: 1000;
        white-space: normal;
        width: 200px;
        left: 50%;
        transform: translateX(-50%);
        top: -40px;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <div class="container my-4">
      <div class="card">
        <div class="card-body">
          <h2>ë°œ ì£¼ ì„œ</h2> <!-- íƒ€ì´í‹€: í°íŠ¸ í¬ê¸°ì™€ ìœ„ì¹˜ëŠ” CSSì˜ h2 ìŠ¤íƒ€ì¼ì—ì„œ ì¡°ì • -->

          <!-- ë°œì‹ ì ì •ë³´ ì˜ì—­ (1ì—´ 2í–‰) -->
          <div class="row g-3 mb-3 justify-content-center">
            <div class="col-md-11">
              <label class="info-label">ê±°ë˜ì²˜ëª…</label>
              <input type="text" class="form-control info-input" id="company" placeholder="ì˜ˆ: ì˜¨ëˆ„ë¦¬ì¢…í•©ì‹í’ˆ" spellcheck="false">
              <label class="info-label mt-2">ì—°ë½ì²˜</label>
              <input type="text" class="form-control info-input" id="phone" placeholder="010-1234-5678" spellcheck="false">
            </div>
          </div>

          <!-- í’ˆëª© ì…ë ¥ í…Œì´ë¸” -->
          <div class="table-responsive mb-3">
            <table class="table table-bordered align-middle" id="orderTable">
              <thead>
                <tr>
                  <th style="width:50px;">No</th>
                  <th style="width:150px;" class="required">ê¸‰ì‹ì¼</th>
                  <th style="width:300px;" class="required">ìƒí’ˆëª…</th>
                  <th style="width:500px;" class="required">ìƒí’ˆ ì„¤ëª…</th>
                  <th style="width:200px;" class="required">ê·œ ê²©</th>
                  <th style="width:150px;" class="required">ìˆ˜ ëŸ‰</th>
                  <th style="width:150px;" class="required">ë‹¨ ìœ„</th>
                  <th style="width:200px;" class="required">ë‚©í’ˆì²˜</th>
                  <th style="width:200px;">ì…ê³  í¬ë§ì¼</th>
                  <th style="width:200px;">ë¹„ ê³ </th>
                  <th style="width:50px;">ì‚­ì œ</th>
                </tr>
              </thead>
              <tbody id="orderBody">
                <!-- ë™ì  í–‰ì´ ì¶”ê°€ë©ë‹ˆë‹¤ -->
              </tbody>
            </table>
          </div>

          <!-- ë²„íŠ¼ ì˜ì—­ (ì¤‘ì•™ ì •ë ¬) -->
          <div class="button-group">
            <button class="btn btn-outline-primary btn-lg" onclick="addRow()">+ í’ˆëª© ì¶”ê°€</button>
            <button class="btn btn-primary btn-lg" onclick="submitOrder()">ì œì¶œ</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <!-- Flatpickr í•œêµ­ì–´ ë¡œì¼€ì¼ -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>
    <script>
      let rowCount = 0;

      // í˜ì´ì§€ ë¡œë”© ì‹œ ìë™ìœ¼ë¡œ 3í–‰ ì¶”ê°€
      window.onload = function() {
        for (let i = 0; i < 3; i++) addRow();
      };

      function addRow() {
        rowCount++;
        const tbody = document.getElementById("orderBody");
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${rowCount}</td>
          <td class="calendar-cell meal-date-cell"> <!-- 2ì—´: ê¸‰ì‹ì¼ -->
            <input type="text" name="mealDate" placeholder="ë‚ ì§œ ì„ íƒ" readonly spellcheck="false">
          </td>
          <td class="product-name-cell"> <!-- 3ì—´: ìƒí’ˆëª… -->
            <textarea class="form-control" name="productName" oninput="adjustTextareaHeight(this); this.setAttribute('title', this.value)" spellcheck="false"></textarea>
          </td>
          <td class="description-cell"> <!-- 4ì—´: ì„¤ëª… -->
            <textarea class="form-control" name="description" oninput="adjustTextareaHeight(this); this.setAttribute('title', this.value)" spellcheck="false"></textarea>
          </td>
          <td class="specification-cell"> <!-- 5ì—´: ê·œê²© -->
            <input type="text" class="form-control" name="specification" maxlength="12" oninput="this.setAttribute('title', this.value)" spellcheck="false">
          </td>
          <td class="quantity-cell"> <!-- 6ì—´: ìˆ˜ëŸ‰ -->
            <input type="number" class="form-control" name="quantity" maxlength="12" oninput="this.setAttribute('title', this.value)" spellcheck="false">
          </td>
          <td class="unit-cell"> <!-- 7ì—´: ë‹¨ìœ„ -->
            <input type="text" class="form-control" name="unit" maxlength="12" oninput="this.setAttribute('title', this.value)" spellcheck="false">
          </td>
          <td class="delivery-to-cell"> <!-- 8ì—´: ë‚©í’ˆì²˜ -->
            <input type="text" class="form-control" name="deliveryTo" maxlength="12" oninput="this.setAttribute('title', this.value)" spellcheck="false">
          </td>
          <td class="calendar-cell desired-date-cell"> <!-- 9ì—´: ì…ê³ í¬ë§ì¼ -->
            <input type="text" name="desiredDate" placeholder="ë‚ ì§œ ì„ íƒ" readonly spellcheck="false">
          </td>
          <td class="note-cell"> <!-- 10ì—´: ë¹„ê³  -->
            <input type="text" class="form-control" name="note" oninput="this.setAttribute('title', this.value)" spellcheck="false">
          </td>
          <td><button class="btn btn-sm btn-danger" onclick="this.parentElement.parentElement.remove()">X</button></td>
        `;
        tbody.appendChild(row);

        // Flatpickr ì´ˆê¸°í™” (í•œêµ­ì–´ ë¡œì¼€ì¼ ì ìš©)
        flatpickr(".calendar-cell input[name='mealDate'], .calendar-cell input[name='desiredDate']", {
          dateFormat: "Y-m-d",
          locale: "ko",
          onChange: function(selectedDates, dateStr, instance) {
            const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            const date = new Date(dateStr);
            const formatted = `${dateStr} (${weekdays[date.getDay()]})`;
            instance.element.value = formatted;
            instance.element.setAttribute('title', formatted);
          }
        });
      }

      // textarea ë†’ì´ ë™ì  ì¡°ì • í•¨ìˆ˜
      function adjustTextareaHeight(textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = `${textarea.scrollHeight}px`;
      }

      function submitOrder() {
        const company = document.getElementById("company").value.trim();
        const phone = document.getElementById("phone").value.trim();

        if (!company || !phone) {
          alert("ğŸ“Œ ê±°ë˜ì²˜ëª…ê³¼ ì—°ë½ì²˜ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        const rows = document.querySelectorAll("#orderBody tr");
        let items = [];
        let hasError = false;

        rows.forEach((row, index) => {
          const cells = row.querySelectorAll("input, textarea");
          const item = {
            mealDate: cells[0].value,
            productName: cells[1].value,
            description: cells[2].value,
            specification: cells[3].value,
            quantity: cells[4].value,
            unit: cells[5].value,
            deliveryTo: cells[6].value,
            desiredDate: cells[7].value,
            note: cells[8].value
          };

          if (item.mealDate && item.productName && item.description && item.specification && item.quantity && item.unit && item.deliveryTo) {
            items.push(item);
          } else if (item.mealDate || item.productName || item.description || item.specification || item.quantity || item.unit || item.deliveryTo) {
            alert(`ğŸš¨ ${index + 1}ë²ˆì§¸ í’ˆëª©ì— í•„ìˆ˜ í•­ëª©ì´ ëˆ„ë½ëìŠµë‹ˆë‹¤.`);
            hasError = true;
            return;
          }
        });

        if (hasError || items.length === 0) {
          if (items.length === 0) alert("ğŸ“Œ ìµœì†Œ í•œ ê°œ ì´ìƒì˜ í’ˆëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        const scriptUrl = "https://script.google.com/macros/s/AKfycbwY-MGQjuathjK_N5ZKHk5Kc37HMGmLDNX12L65C_9tBop89tA3okfHt6nHoe0vDJyVEw/exec";

        fetch(scriptUrl, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({
            company,
            phone,
            items: JSON.stringify(items)
          })
        })
        .then(res => res.text())
        .then(msg => {
          alert(msg);
          window.scrollTo(0, 0);
          location.reload();
        })
        .catch(err => {
          alert("âŒ ì˜¤ë¥˜ ë°œìƒ: " + err);
          console.error(err);
        });
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
