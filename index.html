<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
    <title>í•™êµ ê¸‰ì‹ ì¬ë£Œ ì£¼ë¬¸ì„œ</title>
    <!-- êµ¬ê¸€ í°íŠ¸ (Noto Sans) -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500&display=swap" rel="stylesheet">
    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
      body {
        font-family: 'Noto Sans KR', sans-serif;
        background-color: #f8f9fa;
      }
      h2 {
        font-weight: 600;
      }
      .table thead th {
        background-color: #f0f0f0;
      }
      /* ë°œì‹ ì ì •ë³´ ë ˆì´ë¸” ê°„ê²© ì¡°ì • */
      .info-label {
        margin-bottom: 0.5rem;
        font-weight: 500;
      }
      .info-input {
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <div class="container my-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="mb-4">í•™êµ ê¸‰ì‹ ì¬ë£Œ ì£¼ë¬¸ì„œ</h2>

          <!-- ë°œì‹ ì ì •ë³´ ì˜ì—­ -->
          <div class="row g-3 mb-3">
            <div class="col-md-3">
              <label class="info-label">ì´ë©”ì¼</label>
              <input type="email" class="form-control info-input" id="email" placeholder="email@domain.com">
            </div>
            <div class="col-md-3">
              <label class="info-label">ê±°ë˜ì²˜ëª…</label>
              <input type="text" class="form-control info-input" id="company" placeholder="ì˜ˆ: ì˜¨ëˆ„ë¦¬ì¢…í•©ì‹í’ˆ">
            </div>
            <div class="col-md-3">
              <label class="info-label">ë°œì‹ ìëª…</label>
              <input type="text" class="form-control info-input" id="name" placeholder="í™ê¸¸ë™">
            </div>
            <div class="col-md-3">
              <label class="info-label">ì—°ë½ì²˜</label>
              <input type="text" class="form-control info-input" id="phone" placeholder="010-1234-5678">
            </div>
          </div>

          <!-- í’ˆëª© ì…ë ¥ í…Œì´ë¸” -->
          <div class="table-responsive mb-3">
            <table class="table table-bordered align-middle" id="orderTable">
              <thead>
                <tr>
                  <th style="width:50px;">No</th>
                  <th style="width:120px;">ê¸‰ì‹ì¼</th>
                  <th style="width:160px;">ìƒí’ˆëª…</th>
                  <th>ì„¤ëª…</th>
                  <th style="width:80px;">ê·œê²©</th>
                  <th style="width:80px;">ìˆ˜ëŸ‰</th>
                  <th style="width:80px;">ë‹¨ìœ„</th>
                  <th style="width:120px;">ë‚©í’ˆì²˜</th>
                  <th style="width:120px;">ì…ê³ í¬ë§ì¼</th>
                  <th style="width:120px;">ë¹„ê³ </th>
                  <th style="width:50px;">ì‚­ì œ</th>
                </tr>
              </thead>
              <tbody id="orderBody">
                <!-- ë™ì  í–‰ì´ ì¶”ê°€ë©ë‹ˆë‹¤ -->
              </tbody>
            </table>
          </div>

          <!-- ë²„íŠ¼ ì˜ì—­ -->
          <div class="mb-3">
            <button class="btn btn-outline-primary me-2" onclick="addRow()">+ í’ˆëª© ì¶”ê°€</button>
            <button class="btn btn-primary" onclick="submitOrder()">ì œì¶œ</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      let rowCount = 0;

      // í˜ì´ì§€ ë¡œë”© ì‹œ ìë™ìœ¼ë¡œ 1í–‰ ì¶”ê°€
      window.onload = addRow;

      function addRow() {
        rowCount++;
        const tbody = document.getElementById("orderBody");
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${rowCount}</td>
          <td><input type="date" class="form-control" name="mealDate"></td>
          <td><input type="text" class="form-control" name="productName"></td>
          <td><input type="text" class="form-control" name="description"></td>
          <td><input type="text" class="form-control" name="specification"></td>
          <td><input type="number" class="form-control" name="quantity"></td>
          <td><input type="text" class="form-control" name="unit"></td>
          <td><input type="text" class="form-control" name="deliveryTo"></td>
          <td><input type="date" class="form-control" name="desiredDate"></td>
          <td><input type="text" class="form-control" name="note"></td>
          <td><button class="btn btn-sm btn-danger" onclick="this.parentElement.parentElement.remove()">X</button></td>
        `;
        tbody.appendChild(row);
      }

      function submitOrder() {
        const email = document.getElementById("email").value.trim();
        const company = document.getElementById("company").value.trim();
        const name = document.getElementById("name").value.trim();
        const phone = document.getElementById("phone").value.trim();

        // ë°œì‹ ì ì •ë³´ ìœ íš¨ì„± ê²€ì‚¬
        if (!email || !company || !name || !phone) {
          alert("ğŸ“Œ ë°œì‹ ì ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        const rows = document.querySelectorAll("#orderBody tr");
        let items = [];
        let hasError = false;

        rows.forEach((row, index) => {
          const cells = row.querySelectorAll("input");

          const item = {
            mealDate: cells[0].value,
            productName: cells[1].value,
            description: cells[2].value,
            specification: cells[3].value,
            quantity: cells[4].value,
            unit: cells[5].value,
            deliveryTo: cells[6].value,
            desiredDate: cells[7].value,
            note: cells[8].value
          };

          // í•„ìˆ˜ í•­ëª© ê²€ì‚¬
          if (!item.mealDate || !item.productName || !item.quantity || !item.deliveryTo) {
            alert(`ğŸš¨ ${index + 1}ë²ˆì§¸ í’ˆëª©ì— í•„ìˆ˜ í•­ëª©ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.`);
            hasError = true;
            return;
          }

          items.push(item);
        });

        if (hasError) return;

        // ì•„ë˜ ì£¼ì†Œë¥¼ ë³¸ì¸ì˜ Google Apps Script ì›¹ì•± URLë¡œ êµì²´í•˜ì„¸ìš”
        const scriptUrl = "https://script.google.com/macros/s/AKfycbwY-MGQjuathjK_N5ZKHk5Kc37HMGmLDNX12L65C_9tBop89tA3okfHt6nHoe0vDJyVEw/exec";

        fetch(scriptUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          },
          body: new URLSearchParams({
            email,
            company,
            name,
            phone,
            items: JSON.stringify(items)
          })
        })
        .then(res => res.text())
        .then(msg => {
          alert(msg);
          window.scrollTo(0, 0);
          location.reload(); // ì…ë ¥ í¼ ì´ˆê¸°í™”
        })
        .catch(err => {
          alert("âŒ ì˜¤ë¥˜ ë°œìƒ: " + err);
          console.error(err);
        });
      }
    </script>

    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© JS (ì„ íƒ) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
